---
title: "fisheryO: Effort Overview"
author: ""
date: '`r strftime(Sys.time(), format = "%d %B %Y")`'
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{"fisheryO: Effort Overview"}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
[<img align="right" alt="ICES Logo" width="17%" height="17%" src="http://www.ices.dk/_layouts/15/1033/images/icesimg/iceslogo.png">](http://www.ices.dk/Pages/default.aspx) 

# Effort Overview 

## Introduction
Fishing effort regimes have been reviewed by [STECF](https://stecf.jrc.ec.europa.eu/documents/43805/870977/2014-12_STECF+14-20+-+Evaluation+of+Fishing+Effort+Regimes+-p2_JRC93183.pdf). These data are aggregated as "effort trends by country" and "landings, discards and discard rates." To understand how fishing effort regimes have changed over time, it is useful to calculate a time series of total effort by country and species for each ecoregion. Countries have submitted these data at different spatial and taxonomic designations over time and several steps need to be taken to create a homologous dataset. Area designations are established by [STECF](https://datacollection.jrc.ec.europa.eu/c/document_library/get_file?uuid=62841ee4-dbbd-4628-a7a7-5036ce5d415b&groupId=10213).

## Download Data and house-keeping
```{r DataDownload, include = TRUE, message = FALSE}
library(dplyr, quietly = TRUE)
library(tidyr, quietly = TRUE)
library(reshape2, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(knitr, quietly = TRUE)
# library(gridExtra, quietly = TRUE)
# library(dygraphs, quietly = TRUE)
# library(xts, quietly = TRUE)
library(readxl, quietly = TRUE)
# library(grid, quietly = TRUE)
library(stringr)
library(ggrepel)

options(scipen = 5)
 
baseLoc <- system.file(package = "fisheryO")
extPath <- file.path(baseLoc, "extdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# DATA SOURCE: STECF effort and catch statistics #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
# (NOTE: Will be replaced with RDB data- SL)
effortURL <- "http://stecf.jrc.ec.europa.eu/documents/43805/870977/2014_STECF+14-20+-+Fishing+Effort+Regimes+data+tables.zip"
tmpFileEffort <- tempfile(fileext = ".zip")
download.file(effortURL, destfile = tmpFileEffort, mode = "wb", quiet = TRUE)
effortDat <- read_excel(unzip(tmpFileEffort,
                              files = "Electronic_appendices/Effort_trends_by_country.xlsx"),
                        sheet = "kWdays at sea")
# 
stecfCatchDat <- read_excel(unzip(tmpFileEffort,
                                  files = "Electronic_appendices/Landings_Discards_Discard-rates.xlsx"),
                            sheet = "Land_Disc_Disc-rate_by_Country")

```

## Data manipulation
To manipulate these raw data into something useable, "helper" files are downloaded 

* spList - [FAO ASFIS species list](http://www.fao.org/fishery/collection/asfis/en)

```{r WebHelpers, include = TRUE}
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# DATA SOURCE: FAO species names and labels #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
spURL <- "ftp://ftp.fao.org/FI/STAT/DATA/ASFIS_sp.zip"
tmpFileSp <- tempfile(fileext = ".zip")
download.file(spURL, destfile = tmpFileSp, mode = "wb", quiet = TRUE)
spList <- read.delim(unz(tmpFileSp,
                         "ASFIS_sp_Feb_2016.txt"), 
                     fill = TRUE,
                     stringsAsFactors = FALSE, header = TRUE)
# 
spList <- spList %>%
  select(X3A_CODE, 
         Scientific_name, 
         English_name) %>%
  bind_rows(data.frame(X3A_CODE = "OTH", 
              Scientific_name = "OTHER",
              English_name = "OTHER"))
```

A few other "helper" files have been created and are found in "extdata" folder within 'fisheryO' package. (SL- create a link to the R script when possible)

* areaID - Manually creates a link between ICES Ecoregions and the area designations found in the STECF effort and catch databases
* countryNames - Cleans up discrepancies between ICES and STECF country codes and corrects them to the ISO standards 
* gearNames - STECF gear designations for each Effort Management Regime


```{r LocalHelpers, include = TRUE}
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# DATA SOURCE:STECF effort and ICES catch databases #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

#(NOTE: this file was created manually - with stock list database this should not be necessary - SL)
areaDat <- read.csv("~/git/ices-dk/fisheryO/inst/extdata/areaList.csv",
                   stringsAsFactors = FALSE)

areaID <- areaDat %>%
  filter(areaType %in% c("STECFarea"),
         FO2016 == TRUE) %>%
  mutate(ANNEX_ID = as.character(lapply(strsplit(value, "_"), head, n = 1)),
         RegCodeArea = as.character(lapply(strsplit(value, "_"), tail, n = 1))) %>%
  select(-ICESarea)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# DATA SOURCE:STECF effort and ICES catch databases #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
gearNames <- read.csv("~/git/ices-dk/fisheryO/inst/extdata/gearNames.csv",
                      stringsAsFactors = FALSE)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# CODE TO CREATE FILE: fisheryO/R/FisheriesAdvice/countryNames.R #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
countryNames <- read.csv("~/git/ices-dk/fisheryO/inst/extdata/countryNames.csv",
                         stringsAsFactors = FALSE)

countryNames <- countryNames %>%
  filter(VARIABLE %in% c("stNames"))
```

STECF reports landings and effort based on 11 effort management regimes. One caveat is that data must not be summed across different annexes. Management regimes cross ecoregion boundaries, but they are specified with ICES area designations. Therefore, each management regime can be subdivided into ICES Ecoregions. 

```{r AggregateEffortData, include = TRUE}
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# Data cleaning and aggregating #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# 
effortDatClean <- effortDat %>%
    Filter(f = function(x)!all(is.na(x))) %>%
    rename(ANNEX_ID = annex,
           RegCodeArea = reg_area_cod,
           RegCodeGear = reg_gear_cod) %>%
    melt(id.vars = c("ANNEX_ID", "RegCodeArea", "RegCodeGear", "Specon_calc", "country", "vessel_length"), 
         variable.name = "YEAR",
         value.name = "VALUE") %>%
    mutate(YEAR = as.numeric(levels(YEAR))[YEAR]) %>%
    full_join(gearNames, c("RegCodeGear" = "GEAR",
                           "ANNEX_ID" = "ANNEX_ID")) %>% # merge with gear names
    full_join(countryNames, c("country" = "VALUE")) %>% # merge with ISO country names
    full_join(areaID, c("ANNEX_ID" = "ANNEX_ID",
                        "RegCodeArea" = "RegCodeArea")) %>% # Merge to add ecoregions (only areas defined in catchAreaID!)
    filter(RegCodeArea %in% areaID$RegCodeArea) %>%
    select(YEAR, 
         ECOREGION = Ecoregion,
         COUNTRY,
         ISO3,
         ANNEX,
         AREA = RegCodeArea,
         GEAR = GEAR_NAME,
         VALUE)

```



```{r stecfAreaPlotEffort, include = TRUE}
# allDat <- effortDatClean
# IA = unique(allDat$ECOREGION)[1]
# type = c("GEAR", "COUNTRY")[1]

stecfEffortAreaPlot <- function(IA = unique(allDat$ECOREGION)[1], 
                                type = c("GEAR", "COUNTRY")[1],
                                fig.save = FALSE,
                                fig.plot = TRUE,
                                fig.width = 174,
                                fig.height = 68,
                                text.size = 9,
                                ...) {
  
  iaDat <- allDat[allDat$ECOREGION == IA,] 
  
  dots <- lapply(c("ANNEX", type, "YEAR"), as.symbol)
  
  catchPlot <- iaDat %>%
    group_by_(.dots = dots[1:2]) %>%
    dplyr::summarize(typeTotal = sum(VALUE, na.rm = TRUE)) %>% # Overall catch to order plot
    arrange(ANNEX, -typeTotal) %>%
    filter(typeTotal >= 1) %>%
    group_by(ANNEX) %>%
    dplyr::mutate(RANK = min_rank(desc(typeTotal))) %>%
    inner_join(iaDat, ifelse(type == "GEAR", 
                             c("GEAR" = "GEAR"),
                             c("COUNTRY" = "COUNTRY"))) %>%
    ungroup() %>%
    select(-ANNEX.y,
           ANNEX = ANNEX.x) %>%
    dplyr::mutate(GEAR = replace(GEAR, RANK > 10, "OTHER"),
                  COUNTRY = replace(COUNTRY, RANK > 10, "OTHER"),
                  ANNEX = str_wrap(ANNEX, width = 26)) %>%
    group_by_(.dots = dots) %>%
    dplyr::summarize(typeTotal = sum(VALUE, na.rm = TRUE))

  if(IA %in% c("Baltic Sea", "Greater North Sea")) {
    catchPlot <- catchPlot[catchPlot$ANNEX == "Cod recovery zone",]
  }
  if(IA %in% c("Bay of Biscay and the Iberian Coast", "Iceland Sea", "Oceanic north-east Atlantic", "Azores", "Greenland Sea")) {
    catchPlot <- catchPlot[catchPlot$ANNEX == "Deep sea",]
  }
  if(IA %in% c("Celtic Seas")) {
    catchPlot <- catchPlot[catchPlot$ANNEX == "Celtic Sea (entire)",]
  }

  
    
  if(nchar(max(catchPlot$typeTotal, na.rm = TRUE)) >= 6) {
    catchPlot$typeTotal <- catchPlot$typeTotal / 1000
    catchLabel <- "Effort (1000 kW days at sea)"
  } else {
    catchLabel <- "Effort (kW days at sea)"
  }
  
  # 
  catchPlot <- rbind(catchPlot[!catchPlot[[type]] == "OTHER",],
                     catchPlot[catchPlot[[type]] == "OTHER",])
  
   colList = list(colList1 = c("#002D60", # ICES Blue: 
                              "#3D6899", # Dust Blue: 
                              "#00FEFF", # Bright Blue: 
                              "#FF6B40", # Pale Orange: 
                              "#CC2314"), # Carmine Red: 
                 # COMPOUND 2
                 colList2 = c("#80AEA0", # ICES Green: 
                              "#3D9970", # Olive Green:
                              "#00FF21", # Bright Green: 
                              "#FF40D3", # Fuchsia: 
                              "#B114CC"), # Purple: 
                 # COMPOUND 3
                 colList3 = c("#35C9B6", # Ocean Green: 
                              "#3D998D", # Ph. Green: 
                              "#00FF4E", # Bright Green 2:
                              "#FF4098", # Pink: 
                              "#CC14C5"), # Fuchsia 2: 
                 # COMPOUND 4: 
                 colList4 = c("#26FFFF", # Sky Blue: 
                              "#3D9999", # Dust Blue: 
                              "#00FF6C", # Bright Green 3: 
                              "#FF406C", # Dark pink:
                              "#CC149b")) # Fuchsia 3
  
  colList <- unlist(colList[c(sample(x = 1:4, 2, replace = FALSE))])
  
  # colList <- c("#DB9D85", "#C7A76C", "#ABB065", "#86B875", "#5CBD92",
  #              "#39BEB1", "#4CB9CC", "#7DB0DD", "#ACA4E2", "#CD99D8")
   
  catchPlot[[type]] <- factor(catchPlot[[type]], levels = unique(catchPlot[[type]]))
  myColors <- colList[1:length(unique(catchPlot[[type]]))]
  names(myColors) <- levels(catchPlot[[type]])
  myColors["OTHER"] <- "grey40"
  
  
  
  catchPlot$ANNEX <- as.factor(catchPlot$ANNEX)
  
  plotFun <- function(xColors) {
    pl <- ggplot(catchPlot, aes(x = YEAR, y = typeTotal)) +
      geom_area(aes_string(fill = type, color = type), alpha = .8, position = "stack") +
      geom_label_repel(data = cumPlot,
                       aes_string(y = "td",
                                  label = type,
                                  fill = type),
                       alpha = 0.8,
                       label.size = 0.15,
                       segment.size = .15,
                       nudge_x = 3,
                       color = "grey20",
                       segment.color = "grey20",
                       force = 3,
                       size = 2) +
      scale_fill_manual(values = xColors) +
      scale_color_manual(values = xColors) +
      scale_y_continuous(labels = scales::comma) + 
      scale_x_continuous(breaks = seq(min(catchPlot$YEAR),
                                      max(catchPlot$YEAR), by = 2)) +
      geom_segment(aes(x = -Inf, xend = 2013, y = -Inf, yend = -Inf), color = "grey50")+
      geom_segment(aes(y = -Inf, yend = Inf, x = -Inf, xend = -Inf), color = "grey50")+
      expand_limits(x = c(min(catchPlot$YEAR), 2018)) + # So that we have enough room along x-axis for labels.
      labs(x = "",
           y = catchLabel) +
      theme_bw(base_size = text.size) +
      theme(legend.position = 'none',
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),
            panel.border = element_blank(),
            strip.background = element_blank(),
            # panel.border = element_rect(colour = "grey50"),
            axis.line = element_blank())
      # facet_wrap(~ANNEX, scales = "free_y", ncol = 2)
    return(pl)
  }

   if(type == "COUNTRY"){
     countryColors <- myColors
  
   cumPlot <-  catchPlot %>% 
      filter(YEAR == 2013) %>%
      # group_by(ANNEX) %>%
     ungroup() %>%
      mutate(cs = cumsum(as.numeric(typeTotal)),
             mp = lag(cs, order_by = COUNTRY),
             mp = ifelse(is.na(mp), 1, mp)) %>%
      ungroup() %>%
      mutate(td = rowMeans(.[,c("cs", "mp")]))
 
    pl <- plotFun(xColors = countryColors)
   }
  
  if(type == "GEAR"){
    gearColors <- myColors
    
    cumPlot <-  catchPlot %>% 
      filter(YEAR == 2013) %>%
      # group_by(ANNEX) %>%
      ungroup() %>%
      mutate(cs = cumsum(as.numeric(typeTotal)),
             mp = lag(cs, order_by = GEAR),
             mp = ifelse(is.na(mp), 1, mp)) %>%
      ungroup() %>%
      mutate(td = rowMeans(.[,c("cs", "mp")]))
    
    pl <- plotFun(xColors = gearColors)
  }

  
  
  if(fig.save == TRUE) {
    figName <- ifelse(type == "COUNTRY", "figure2_", "figure6_")
 
    ggsave(filename = paste0("~/git/ices-dk/fisheryO/output/", figName, IA, ".png"),
           plot = pl, 
           width = fig.width,
           height = fig.height,
           units = "mm",
           dpi = 300)
   
  }
  if(fig.plot == TRUE) {
    pl
  }
}
```

 
  
```{r plotStecfAreaEffort, echo=FALSE, results='hide', fig.keep='all'}
allDat <- effortDatClean 
lapply(unique(allDat$ECOREGION), stecfEffortAreaPlot, type = "COUNTRY", fig.save = TRUE, fig.plot = FALSE) 
lapply(unique(allDat$ECOREGION), stecfEffortAreaPlot, type = "GEAR", fig.save = TRUE, fig.plot = FALSE) 

# lapply(unique(allDat$ECOREGION), stecfEffortAreaPlot, type = "GEAR", fig.save = F, fig.plot = T) 

```



```{r AggregateCatchData, include = TRUE}

stecfCatchDatClean <- stecfCatchDat %>%
  Filter(f = function(x)!all(is.na(x))) %>%
  rename(ANNEX_ID = annex,
         RegCodeArea = reg_area,
         RegCodeGear = reg_gear) %>%
  melt(id.vars = c("ANNEX_ID", "RegCodeArea", "country", "RegCodeGear", "specon", "species"), 
       variable.name = "YEAR",
       value.name = "VALUE") %>%
  mutate(METRIC = as.character(gsub(".*\\s", "", YEAR)),
         YEAR = as.numeric(gsub("\\s.+$", "", YEAR))) %>%
  full_join(gearNames, c("RegCodeGear" = "GEAR",
                         "ANNEX_ID" = "ANNEX_ID")) %>% # merge with gear names
  # left_join(spList, c("species" = "X3A_CODE")) %>% # merge with FAO species names
  # full_join(countryNames, c("country" = "VALUE")) %>% # merge with ISO country names
  full_join(areaID, c("ANNEX_ID" = "ANNEX_ID",
                      "RegCodeArea" = "RegCodeArea")) %>% # Merge to add ecoregions (only areas defined in catchAreaID!)
  filter(RegCodeArea %in% areaID$RegCodeArea,
         METRIC == "L") %>%
  select(YEAR, 
         ECOREGION = Ecoregion,
         # COUNTRY,
         # ISO3,
         ANNEX,
         AREA = RegCodeArea,
         GEAR = GEAR_NAME,
         # SPECIES_NAME = Scientific_name,
         # COMMON_NAME = English_name,
         # SPECIES_CODE = species,
         VALUE)
```


```{r stecfAreaPlotCatch, include = TRUE}

stecfCatchAreaPlot <- function(IA = unique(allDat$ECOREGION)[1],
                               fig.save = FALSE,
                               fig.plot = TRUE,
                               fig.width = 174,
                               fig.height = 68,
                               text.size = 9,
                               ...) {
  
  # 
  iaDat <- allDat[allDat$ECOREGION == IA,] 
  dots <- lapply(c("ANNEX", "GEAR", "YEAR"), as.symbol)
  catchPlot <- iaDat %>%
    group_by_(.dots = dots[1:2]) %>%
    dplyr::summarize(typeTotal = sum(VALUE, na.rm = TRUE)) %>% # Overall catch to order plot
    arrange(ANNEX, -typeTotal) %>%
    filter(typeTotal >= 1) %>%
    group_by(ANNEX) %>%
    dplyr::mutate(RANK = min_rank(desc(typeTotal))) %>%
    inner_join(iaDat, c("GEAR" = "GEAR",
                        "ANNEX" = "ANNEX")) %>%
    ungroup() %>%
    dplyr::mutate(GEAR = replace(GEAR, RANK > 10, "OTHER"),
                  ANNEX = str_wrap(ANNEX, width = 26)) %>%
    group_by_(.dots = dots) %>%
    dplyr::summarize(typeTotal = sum(VALUE, na.rm = TRUE))
  
  if(IA %in% c("Baltic Sea", "Greater North Sea")) {
    catchPlot <- catchPlot[catchPlot$ANNEX == "Cod recovery zone",]
  }
  if(IA %in% c("Bay of Biscay and the Iberian Coast", "Iceland Sea", "Oceanic north-east Atlantic", "Azores", "Greenland Sea")) {
    catchPlot <- catchPlot[catchPlot$ANNEX == "Deep sea",]
  }
  if(IA %in% c("Celtic Seas")) {
    catchPlot <- catchPlot[catchPlot$ANNEX == "Celtic Sea (entire)",]
  }
  
  if(nchar(max(catchPlot$typeTotal, na.rm = TRUE)) >= 6) {
    catchPlot$typeTotal <- catchPlot$typeTotal / 1000
    catchLabel <- "Catch (1000 tonnes)"
  } else {
    catchLabel <- "Catch (tonnes)"
  }
  # 
  catchPlot <- rbind(catchPlot[!catchPlot$GEAR == "OTHER",],
                     catchPlot[catchPlot$GEAR == "OTHER",])
  

   colList = list(colList1 = c("#002D60", # ICES Blue: 
                              "#3D6899", # Dust Blue: 
                              "#00FEFF", # Bright Blue: 
                              "#FF6B40", # Pale Orange: 
                              "#CC2314"), # Carmine Red: 
                 # COMPOUND 2
                 colList2 = c("#80AEA0", # ICES Green: 
                              "#3D9970", # Olive Green:
                              "#00FF21", # Bright Green: 
                              "#FF40D3", # Fuchsia: 
                              "#B114CC"), # Purple: 
                 # COMPOUND 3
                 colList3 = c("#35C9B6", # Ocean Green: 
                              "#3D998D", # Ph. Green: 
                              "#00FF4E", # Bright Green 2:
                              "#FF4098", # Pink: 
                              "#CC14C5"), # Fuchsia 2: 
                 # COMPOUND 4: 
                 colList4 = c("#26FFFF", # Sky Blue: 
                              "#3D9999", # Dust Blue: 
                              "#00FF6C", # Bright Green 3: 
                              "#FF406C", # Dark pink:
                              "#CC149b")) # Fuchsia 3
  
  colList <- unlist(colList[c(sample(x = 1:4, 2, replace = FALSE))])
  
  catchPlot[[type]] <- factor(catchPlot[[type]], levels = unique(catchPlot[[type]]))
  myColors <- colList[1:length(unique(catchPlot[[type]]))]
  names(myColors) <- levels(catchPlot[[type]])
  myColors["OTHER"] <- "grey40"
  
  catchPlot$ANNEX <- as.factor(catchPlot$ANNEX)

  plotFun <- function(xColors) {
    pl <- ggplot(catchPlot, aes(x = YEAR, y = typeTotal)) +
      geom_area(aes_string(fill = type, color = type), alpha = .8, position = "stack") +
      geom_label_repel(data = cumPlot,
                       aes_string(y = "td",
                                  label = type,
                                  fill = type),
                       alpha = 0.8,
                       label.size = 0.15,
                       segment.size = .15,
                       nudge_x = 3,
                       color = "grey20",
                       segment.color = "grey20",
                       force = 3,
                       size = 2) +
      scale_fill_manual(values = xColors) +
      scale_color_manual(values = xColors) +
      scale_y_continuous(labels = scales::comma) + 
      scale_x_continuous(breaks = seq(min(catchPlot$YEAR),
                                      max(catchPlot$YEAR), by = 2)) +
      geom_segment(aes(x = -Inf, xend = 2013, y = -Inf, yend = -Inf), color = "grey50")+
      geom_segment(aes(y = -Inf, yend = Inf, x = -Inf, xend = -Inf), color = "grey50")+
      expand_limits(x = c(min(catchPlot$YEAR), 2018)) + # So that we have enough room along x-axis for labels.
      labs(x = "",
           y = catchLabel) +
      theme_bw(base_size = text.size) +
      theme(legend.position = 'none',
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),
            panel.border = element_blank(),
            # strip.background = element_blank(),
            # panel.border = element_rect(colour = "grey50"),
            axis.line = element_blank())
      # facet_wrap(~ANNEX, scales = "free_y", ncol = 2)
    return(pl)
  }
  
  cumPlot <-  catchPlot %>% 
    filter(YEAR == 2013) %>%
    # group_by(ANNEX) %>%
    ungroup() %>%
    mutate(cs = cumsum(as.numeric(typeTotal)),
           mp = lag(cs, order_by = GEAR),
           mp = ifelse(is.na(mp), 1, mp)) %>%
    ungroup() %>%
    mutate(td = rowMeans(.[,c("cs", "mp")]))
  
  pl <- plotFun(xColors = myColors)
  
  
    
  if(fig.save == TRUE) {
    figName <- "figure5_"
 
    ggsave(filename = paste0("~/git/ices-dk/fisheryO/output/", figName, IA, ".png"),
           plot = pl, 
           width = fig.width,
           height = fig.height,
           units = "mm",
           dpi = 300)
   
  }
  if(fig.plot == TRUE) {
    pl
  }
}
```

 
  
```{r plotStecfAreaCatch, echo=FALSE, fig.width = 20, results='hide', fig.keep='all'}
allDat <- stecfCatchDatClean
lapply(unique(allDat$ECOREGION), stecfCatchAreaPlot,  fig.save = TRUE, fig.plot = FALSE)
```
